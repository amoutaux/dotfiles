# Environment variables
export PATH="/usr/local/bin:$PATH"
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm
export FZF_DEFAULT_COMMAND='rg --files --no-ignore-vcs --hidden' # Set fzf to use ripgrep

# ZSH custom
export ZSH="$HOME/.oh-my-zsh"
ZSH_THEME="agnoster"
CASE_SENSITIVE="true"
ENABLE_CORRECTION="true"
COMPLETION_WAITING_DOTS="true"
DISABLE_AUTO_TITLE="true"

# ZSH plugins to load
# Repo must be cloned in .oh-my-zsh/plugins if it is not done by default
plugins=( git fzf kubectl colored-man-pages zsh-syntax-highlighting )
source $ZSH/oh-my-zsh.sh
source $ZSH/plugins/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh


#Overwrite/add some git plugin aliases
alias gcm="git commit -m"
alias gcom="git checkout master"
alias gai="git add -i"

# You may need to manually set your language environment
export LANG="en_US.UTF-8"
export LC_ALL="en_US.UTF-8"
# Set terminal to use 256 colors
export TERM="screen-256color"
# Custom pager
#export PAGER="/usr/local/bin/less" # macos (native less missing lesskey)

# VBoxManage aliases
alias vms="VBoxManage list vms"
alias rvms="VBoxManage list runningvms"
alias vmstart='f() { VBoxManage startvm "$1" --type headless };f'
alias vmstop='f() { VBoxManage controlvm "$1" poweroff };f'
alias vmip='f(){ VBoxManage guestproperty get "$1" /VirtualBox/GuestInfo/Net/0/V4/IP };f'

# Custom aliases that doesn't fit elsewhere
alias rm="rm -i"
alias tmux="direnv exec / tmux" # Make sure direnv is unloaded before exec tmux
alias letsgo="pipenv install neovim" # For virtual environments setup
alias tiga="tig --all"
alias dm="docker-machine"
alias sshhosts="cat ~/.ssh/config | grep \"^Host\""
alias lst="ls -lhFt"
alias dkrma="docker container rm $(docker container ls -a -q)"

# DIRENV
alias tmux="direnv exec / tmux" # Make sure direnv is unloaded before exec tmux
eval "$(direnv hook zsh)"
# Update PROMPT in case zshrc is sourced inside a virtualenv
#  (without this the PROMPT updated by direnv would be reset)
if [[ -n "$VIRTUAL_ENV" && -n "$DIRENV_DIR" ]]; then
    PROMPT=%{%F{red}%}(${$(basename $VIRTUAL_ENV)%-*})$PROMPT
fi
# If PROMPT is not exported, $PROMPT is null for direnv
export PROMPT

# Show only username in prompt
export DEFAULT_USER=moutauxaurelien
prompt_context() {
  if [[ "$USER" != "$DEFAULT_USER" || -n "$SSH_CLIENT" ]]; then
    prompt_segment black default $USER
  fi
}

# Right prompt show vi-mode + set cursor style accordingly (echo ...)
function zle-line-init zle-keymap-select {
    case $KEYMAP in
        vicmd) RPS1="%F{blue}--NORMAL--"; echo -e -n "\x1b[\x30 q";;
        viins|main) RPS1="%F{yellow}--INSERT--"; echo -e -n "\x1b[\x35 q";;
    esac
    zle reset-prompt
}
zle -N zle-line-init
zle -N zle-keymap-select

# bepo bindings. See zshzle man page for bindkey insights
# zle mole vim
bindkey -v
# Bepo mappings
bindkey -a t vi-backward-char
bindkey -a n vi-forward-char
bindkey -a l vi-repeat-search
bindkey -a L vi-rev-repeat-search
bindkey -a s vi-down-line-or-history
bindkey -a r vi-up-line-or-history
bindkey -a $ vi-end-of-line
bindkey -a 0 vi-digit-or-beginning-of-line
bindkey -a dd vi-change-whole-line
bindkey -a Ã© vi-forward-blank-word
bindkey dv vi-cmd-mode

[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh
